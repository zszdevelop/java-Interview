<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://zszdevelop.github.io/java-study-gitbook/java/jvm/java-jvm-gc-fullgc.html"><meta property="og:site_name" content="Java学习笔记"><meta property="og:title" content="线上如何排查FullGC(系统 CPU 突然飙升且 GC 频繁，你该如何排查)"><meta property="og:description" content="1. 背景 处理过线上问题的同学基本上都会遇到系统突然运行缓慢，CPU 100%,以及Full GC 次数过多的问题。 2. 初步解决方案 如果出现该问题导致线上系统不可用，那么首先需要做的就是，导出jstack和内存信息，然后重启系统。尽快保证系统的可用性。 3. 产生的原因 常见原因 1. 代码中某个位置读取数据量较大，导致系统内存耗尽，从而导致F..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-02-20T13:42:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2023-02-20T13:42:31.000Z"><script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?78dc0e0b4e3aedf643d6621778307a6f";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
      </script><title>线上如何排查FullGC(系统 CPU 突然飙升且 GC 频繁，你该如何排查) | Java学习笔记</title><meta name="description" content="1. 背景 处理过线上问题的同学基本上都会遇到系统突然运行缓慢，CPU 100%,以及Full GC 次数过多的问题。 2. 初步解决方案 如果出现该问题导致线上系统不可用，那么首先需要做的就是，导出jstack和内存信息，然后重启系统。尽快保证系统的可用性。 3. 产生的原因 常见原因 1. 代码中某个位置读取数据量较大，导致系统内存耗尽，从而导致F...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-21064aac.css" as="style"><link rel="stylesheet" href="/assets/style-21064aac.css">
    <link rel="modulepreload" href="/assets/app-891e5fab.js"><link rel="modulepreload" href="/assets/framework-0cf5f349.js"><link rel="modulepreload" href="/assets/java-jvm-gc-fullgc.html-d403a4f9.js"><link rel="modulepreload" href="/assets/java-jvm-gc-fullgc.html-8e98711b.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Java学习笔记"><!----><span class="site-name hide-in-pad">Java学习笔记</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title"><span class="icon iconfont icon-creative"></span>Java</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/java/base/Java-basis-oop.html" class="nav-link" aria-label="Java基础"><!---->Java基础<!----></a></li><li class="dropdown-item"><a href="/java/io/java-io-overview.html" class="nav-link" aria-label="Java IO"><!---->Java IO<!----></a></li><li class="dropdown-item"><a href="/java/collection/java-collection-overview.html" class="nav-link" aria-label="Java集合"><!---->Java集合<!----></a></li><li class="dropdown-item"><a href="/java/thread/java-thread-x-theorty.html" class="nav-link" aria-label="Java并发"><!---->Java并发<!----></a></li><li class="dropdown-item"><a href="/java/java8/java8-lambda.html" class="nav-link" aria-label="Java8"><!---->Java8<!----></a></li><li class="dropdown-item"><a href="/java/jvm/jvm-overview.html" class="nav-link" aria-label="JVM"><!---->JVM<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><span class="icon iconfont icon-creative"></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/sql/sql-x-basic.html" class="nav-link" aria-label="数据库基础/SQL基础"><!---->数据库基础/SQL基础<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Sql数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/sql-mysql-overview.html" class="nav-link" aria-label="Mysql"><!---->Mysql<!----></a></li><li class="dropdown-subitem"><a href="/db/oracle/oracle-b-sequence.html" class="nav-link" aria-label="Oracle"><!---->Oracle<!----></a></li><li class="dropdown-subitem"><a href="/db/dm/dm-operation-console.html" class="nav-link" aria-label="达梦"><!---->达梦<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>NoSql数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/redis/db-redis-introduce.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li><li class="dropdown-subitem"><a href="/db/mongodb/mongo-x-basic.html" class="nav-link" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="dropdown-subitem"><a href="/db/es/elasticsearch-x-introduce-1.html" class="nav-link" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li><li class="dropdown-subitem"><a href="/db/neo4j/neo4j-x-tutorial.html" class="nav-link" aria-label="Neo4J"><!---->Neo4J<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="框架|依赖"><span class="title"><span class="icon iconfont icon-creative"></span>框架|依赖</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Spring</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/spring/spring-overview.html" class="nav-link" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/spring-boot/springboot-x-overview.html" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>ORM</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dependencies/mybatis/mybatis-y-arch.html" class="nav-link" aria-label="Mybatis"><!---->Mybatis<!----></a></li><li class="dropdown-subitem"><a href="/dependencies/mybatis-plus/mybatis-plus-x-gen-code.html" class="nav-link" aria-label="Mybatis-Plus"><!---->Mybatis-Plus<!----></a></li></ul></li><li class="dropdown-item"><a href="/dependencies/office/office-x-aspose.html" class="nav-link" aria-label="Office文档操作"><!---->Office文档操作<!----></a></li><li class="dropdown-item"><a href="/dependencies/cas/cas-x-overview.html" class="nav-link" aria-label="CAS单点登录"><!---->CAS单点登录<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发|测试"><span class="title"><span class="icon iconfont icon-creative"></span>开发|测试</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/develop/devlibrary/dev-lib-lombok.html" class="nav-link" aria-label="开发-常用类库"><span class="icon iconfont icon-creative"></span>开发-常用类库<!----></a></li><li class="dropdown-item"><a href="/develop/security/dev-security-x-injection.html" class="nav-link" aria-label="开发-安全"><span class="icon iconfont icon-creative"></span>开发-安全<!----></a></li><li class="dropdown-item"><a href="/develop/optimization/optimization-x-interface-optimization.html" class="nav-link" aria-label="开发 - 优化"><span class="icon iconfont icon-creative"></span>开发 - 优化<!----></a></li><li class="dropdown-item"><a href="/develop/style/dev-qt-code-style.html" class="nav-link" aria-label="开发 - 规范/风格"><span class="icon iconfont icon-creative"></span>开发 - 规范/风格<!----></a></li><li class="dropdown-item"><a href="/develop/test/ut-overview" class="nav-link" aria-label="测试"><span class="icon iconfont icon-creative"></span>测试<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="软件|部署"><span class="title"><span class="icon iconfont icon-creative"></span>软件|部署</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/deploy/docker/docker-basic-overview.html" class="nav-link" aria-label="Docker"><span class="icon iconfont icon-creative"></span>Docker<!----></a></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>消息队列</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/deploy/mq/mq-a-overview.html" class="nav-link" aria-label="消息队列"><!---->消息队列<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-rabbitmq/rabbitmq-x-overview.html" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-subitem"><a href="/deploy/mq-kafka/kafka-x-overview.html" class="nav-link" aria-label="Kafka"><!---->Kafka<!----></a></li></ul></li><li class="dropdown-item"><a href="/deploy/skywalking/skywalking-x-principle.html" class="nav-link" aria-label="Skywalking"><span class="icon iconfont icon-creative"></span>Skywalking<!----></a></li><li class="dropdown-item"><a href="/deploy/linux/linux-j-monitor-overview.html" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-creative"></span>Linux<!----></a></li><li class="dropdown-item"><a href="/deploy/jenkins/jenkins-overview.html" class="nav-link" aria-label="Jenkins"><span class="icon iconfont icon-creative"></span>Jenkins<!----></a></li><li class="dropdown-item"><a href="/deploy/nginx/nginx-x-overview.html" class="nav-link" aria-label="Nginx"><span class="icon iconfont icon-creative"></span>Nginx<!----></a></li><li class="dropdown-item"><a href="/deploy/deploy/docker-basic-overview" class="nav-link" aria-label="部署"><span class="icon iconfont icon-creative"></span>部署<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="架构|系统"><span class="title"><span class="icon iconfont icon-creative"></span>架构|系统</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/arch/base/arch-basic.html" class="nav-link" aria-label="架构基础"><span class="icon iconfont icon-creative"></span>架构基础<!----></a></li><li class="dropdown-item"><a href="/arch/distributed/arch-id.html" class="nav-link" aria-label="分布式系统"><span class="icon iconfont icon-creative"></span>分布式系统<!----></a></li><li class="dropdown-item"><a href="/arch/microservices/ms-overview.html" class="nav-link" aria-label="微服务"><span class="icon iconfont icon-creative"></span>微服务<!----></a></li><li class="dropdown-item"><a href="/arch/minio/minio-concept.html" class="nav-link" aria-label="对象存储-Minio"><span class="icon iconfont icon-creative"></span>对象存储-Minio<!----></a></li><li class="dropdown-item"><a href="/arch/manage-system/manage-system-technical-selection.html" class="nav-link" aria-label="后台管理系统"><span class="icon iconfont icon-creative"></span>后台管理系统<!----></a></li><li class="dropdown-item"><a href="/arch/mall/mall-sku.html" class="nav-link" aria-label="商城设计"><span class="icon iconfont icon-creative"></span>商城设计<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="语言|平台"><span class="title"><span class="icon iconfont icon-creative"></span>语言|平台</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/language/frontend-layout/flex-layout-overview.html" class="nav-link" aria-label="前端"><span class="icon iconfont icon-creative"></span>前端<!----></a></li><li class="dropdown-item"><a href="/language/python/python-advantage.html" class="nav-link" aria-label="python"><span class="icon iconfont icon-creative"></span>python<!----></a></li><li class="dropdown-item"><a href="/language/weixin/wx-package-Optimization.html" class="nav-link" aria-label="微信"><span class="icon iconfont icon-creative"></span>微信<!----></a></li><li class="dropdown-item"><a href="/language/ai/knowledge-graph-build.html" class="nav-link" aria-label="AI人工智能"><span class="icon iconfont icon-creative"></span>AI人工智能<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="杂项|思考"><span class="title"><span class="icon iconfont icon-creative"></span>杂项|思考</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/think/deepImpression/redis-bigdata-slow-problem.html" class="nav-link" aria-label="印象深刻bug"><span class="icon iconfont icon-creative"></span>印象深刻bug<!----></a></li><li class="dropdown-item"><a href="/think/optimization/optimization-x-frequent-operation-db.html" class="nav-link" aria-label="优化"><span class="icon iconfont icon-creative"></span>优化<!----></a></li><li class="dropdown-item"><a href="/think/misc/misc-x-middleware.html" class="nav-link" aria-label="杂项"><span class="icon iconfont icon-creative"></span>杂项<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/zszdevelop/java-study-gitbook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java基础</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java-IO</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java集合</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">多线程与并发</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java8</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">Jvm</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/java/jvm/jvm-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM相关知识体系详解"><!---->JVM相关知识体系详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-class.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - 类字节码详解"><!---->JVM 基础 - 类字节码详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-class-enhancer.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - 字节码的增强技术"><!---->JVM 基础 - 字节码的增强技术<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-classload.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - Java 类加载机制"><!---->JVM 基础 - Java 类加载机制<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-struct.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - JVM 内存结构"><!---->JVM 基础 - JVM 内存结构<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-heap-s.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - Java内存结构(精简版)"><!---->JVM 基础 - Java内存结构(精简版)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-x-introduce.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - Java 内存模型引入"><!---->JVM 基础 - Java 内存模型引入<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-jmm.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 基础 - Java 内存模型详解"><!---->JVM 基础 - Java 内存模型详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc.html" class="nav-link sidebar-link sidebar-page" aria-label="GC - Java 垃圾回收基础知识"><!---->GC - Java 垃圾回收基础知识<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-g1.html" class="nav-link sidebar-link sidebar-page" aria-label="GC - Java 垃圾回收器之G1详解"><!---->GC - Java 垃圾回收器之G1详解<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-g1-supplement.html" class="nav-link sidebar-link sidebar-page" aria-label="GC - Java 垃圾回收器之G1（补充）"><!---->GC - Java 垃圾回收器之G1（补充）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-cms-gc.html" class="nav-link sidebar-link sidebar-page" aria-label="GC - Java 垃圾回收器之CMS GC问题分析与解决"><!---->GC - Java 垃圾回收器之CMS GC问题分析与解决<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-param.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - JVM 调优参数"><!---->调试排错 - JVM 调优参数<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-oom.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 内存分析之堆内存和MetaSpace内存"><!---->调试排错 - Java 内存分析之堆内存和MetaSpace内存<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-oom-offheap.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 内存分析之堆外内存"><!---->调试排错 - Java 内存分析之堆外内存<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-thread-dump.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 线程分析之线程Dump分析"><!---->调试排错 - Java 线程分析之线程Dump分析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-oom-tool.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 问题排查之JVM可视化工具"><!---->调试排错 - Java 问题排查之JVM可视化工具<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-agent-arthas.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 问题排查之应用在线调试Arthas"><!---->调试排错 - Java 问题排查之应用在线调试Arthas<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-agent-arthas-problem.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Arthas 遇到的问题"><!---->调试排错 - Arthas 遇到的问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-debug-idea.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 问题排查之使用IDEA本地调试和远程调试"><!---->调试排错 - Java 问题排查之使用IDEA本地调试和远程调试<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-agent-usage.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java动态调试技术原理"><!---->调试排错 - Java动态调试技术原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-help.html" class="nav-link sidebar-link sidebar-page" aria-label="GC中对象自救"><!---->GC中对象自救<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-log.html" class="nav-link sidebar-link sidebar-page" aria-label="gc日志分析"><!---->gc日志分析<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-optimization-size.html" class="nav-link sidebar-link sidebar-page" aria-label="Java堆设置多大合适"><!---->Java堆设置多大合适<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-adapter.html" class="nav-link sidebar-link sidebar-page" aria-label="Java如何选择合适的垃圾回收器"><!---->Java如何选择合适的垃圾回收器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-tools-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="JDK监控和故障处理工具汇总"><!---->JDK监控和故障处理工具汇总<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-optimization-jstack.html" class="nav-link sidebar-link sidebar-page" aria-label="jstack等命令的实现原理"><!---->jstack等命令的实现原理<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-dispatch.html" class="nav-link sidebar-link sidebar-page" aria-label="JVM 内存分配与回收"><!---->JVM 内存分配与回收<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-tools-visualvm.html" class="nav-link sidebar-link sidebar-page" aria-label="mac版idea配置visualvm"><!---->mac版idea配置visualvm<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-tools-mat-use.html" class="nav-link sidebar-link sidebar-page" aria-label="MAT使用"><!---->MAT使用<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-tools-mat.html" class="nav-link sidebar-link sidebar-page" aria-label="MAT安装"><!---->MAT安装<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-tools-mat-shallow.html" class="nav-link sidebar-link sidebar-page" aria-label="Shallow heap和Retained heap"><!---->Shallow heap和Retained heap<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-classload-tomcat.html" class="nav-link sidebar-link sidebar-page" aria-label="tomcat类加载器"><!---->tomcat类加载器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-overview.html" class="nav-link sidebar-link sidebar-page" aria-label="垃圾收集器"><!---->垃圾收集器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-orth.html" class="nav-link sidebar-link sidebar-page" aria-label="垃圾收集器垃圾收集算法"><!---->垃圾收集器垃圾收集算法<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-optimization.html" class="nav-link sidebar-link sidebar-page" aria-label="如何合理的规划 JVM 性能调优"><!---->如何合理的规划 JVM 性能调优<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-gc-object-die.html" class="nav-link sidebar-link sidebar-page" aria-label="对象已经死亡？"><!---->对象已经死亡？<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-classload1.html" class="nav-link sidebar-link sidebar-page" aria-label="类加载器"><!---->类加载器<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-classload-interview.html" class="nav-link sidebar-link sidebar-page" aria-label="类加载器（常见面试）"><!---->类加载器（常见面试）<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/jvm.html" class="nav-link sidebar-link sidebar-page" aria-label="类加载过程"><!---->类加载过程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-classload-simplify.html" class="nav-link sidebar-link sidebar-page" aria-label="类加载过程(精简版)"><!---->类加载过程(精简版)<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="线上如何排查FullGC(系统 CPU 突然飙升且 GC 频繁，你该如何排查)"><!---->线上如何排查FullGC(系统 CPU 突然飙升且 GC 频繁，你该如何排查)<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_1-背景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. 背景"><!---->1. 背景<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_2-初步解决方案" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. 初步解决方案"><!---->2. 初步解决方案<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-产生的原因" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. 产生的原因"><!---->3. 产生的原因<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-1-full-gc次数过多导致" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.1 Full GC次数过多导致"><!---->3.1 Full GC次数过多导致<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-2-cpu过高" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.2 CPU过高"><!---->3.2 CPU过高<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-3-不定期出现的接口耗时现象" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.3 不定期出现的接口耗时现象"><!---->3.3 不定期出现的接口耗时现象<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-4-某个线程进入waiting状态" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.4 某个线程进入WAITING状态"><!---->3.4 某个线程进入WAITING状态<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-5-死锁" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3.5 死锁"><!---->3.5 死锁<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_4-总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. 总结"><!---->4. 总结<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#面试实战" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="面试实战"><!---->面试实战<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#参考文章" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="参考文章"><!---->参考文章<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-tools-mat-peoject.html" class="nav-link sidebar-link sidebar-page" aria-label="记一次MAT分析线上项目过程"><!---->记一次MAT分析线上项目过程<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-debug-tools-linux.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 问题排查之Linux命令"><!---->调试排错 - Java 问题排查之Linux命令<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/java/jvm/java-jvm-debug-tools-list.html" class="nav-link sidebar-link sidebar-page" aria-label="调试排错 - Java 问题排查之工具单"><!---->调试排错 - Java 问题排查之工具单<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java-编译</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->线上如何排查FullGC(系统 CPU 突然飙升且 GC 频繁，你该如何排查)</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://java.isture.com" target="_blank" rel="noopener noreferrer">zszdevelop</a></span><span property="author" content="zszdevelop"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-02-20T13:42:31.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 8 分钟</span><meta property="timeRequired" content="PT8M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_1-背景" class="router-link-active router-link-exact-active toc-link level2">1. 背景</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_2-初步解决方案" class="router-link-active router-link-exact-active toc-link level2">2. 初步解决方案</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-产生的原因" class="router-link-active router-link-exact-active toc-link level2">3. 产生的原因</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-1-full-gc次数过多导致" class="router-link-active router-link-exact-active toc-link level3">3.1 Full GC次数过多导致</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-2-cpu过高" class="router-link-active router-link-exact-active toc-link level3">3.2 CPU过高</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-3-不定期出现的接口耗时现象" class="router-link-active router-link-exact-active toc-link level3">3.3 不定期出现的接口耗时现象</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-4-某个线程进入waiting状态" class="router-link-active router-link-exact-active toc-link level3">3.4 某个线程进入WAITING状态</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_3-5-死锁" class="router-link-active router-link-exact-active toc-link level3">3.5 死锁</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#_4-总结" class="router-link-active router-link-exact-active toc-link level2">4. 总结</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#面试实战" class="router-link-active router-link-exact-active toc-link level2">面试实战</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/java/jvm/java-jvm-gc-fullgc.html#参考文章" class="router-link-active router-link-exact-active toc-link level2">参考文章</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="线上如何排查fullgc-系统-cpu-突然飙升且-gc-频繁-你该如何排查" tabindex="-1"><a class="header-anchor" href="#线上如何排查fullgc-系统-cpu-突然飙升且-gc-频繁-你该如何排查" aria-hidden="true">#</a> 线上如何排查FullGC(系统 CPU 突然飙升且 GC 频繁，你该如何排查)</h1><h2 id="_1-背景" tabindex="-1"><a class="header-anchor" href="#_1-背景" aria-hidden="true">#</a> 1. 背景</h2><p>处理过线上问题的同学基本上都会遇到系统突然运行缓慢，CPU 100%,以及Full GC 次数过多的问题。</p><h2 id="_2-初步解决方案" tabindex="-1"><a class="header-anchor" href="#_2-初步解决方案" aria-hidden="true">#</a> 2. 初步解决方案</h2><p>如果出现该问题导致线上系统不可用，那么首先需要做的就是，<strong>导出jstack和内存信息，然后重启系统</strong>。尽快保证系统的可用性。</p><h2 id="_3-产生的原因" tabindex="-1"><a class="header-anchor" href="#_3-产生的原因" aria-hidden="true">#</a> 3. 产生的原因</h2><p>常见原因</p><ol><li>代码中某个位置读取数据量较大，导致系统内存耗尽，从而导致Full GC次数过多，系统缓慢</li><li>代码中有较多消耗CPU的操作，导致CPU过高，系统运行缓慢</li></ol><p>相对来说，这是出现频率最高的两种线上问题，而且它们会直接导致系统不可用。另外有几种情况也会导致某个功能运行缓慢，但是不至于导致系统不可用：</p><ol start="3"><li>代码某个位置有阻塞性的操作，导致该功能调用整体比较耗时，但出现是比较随机的</li><li>某个线程由于某种原因而进入WAITING状态，从而导致系统整体比较缓慢</li><li>由于锁使用不当，导致多个线程进入死锁状态，从而导致系统整体比较缓慢</li></ol><p>对于这三种情况，通过查看CPU和系统内存情况是无法查看出具体问题的，因为它们相对来说都是具有一定阻塞性操作，CPU和系统内存使用情况都不高，但是功能却很慢。下面我们就通过查看系统日志来一步一步甄别上述几种问题。</p><h3 id="_3-1-full-gc次数过多导致" tabindex="-1"><a class="header-anchor" href="#_3-1-full-gc次数过多导致" aria-hidden="true">#</a> 3.1 Full GC次数过多导致</h3><p>相对来说，这种情况是最容易出现的，尤其是新功能上线时。对于Full GC较多的情况，其主要有如下两个特征：</p><ul><li>线上多个线程的CPU都超过了100%，通过jstack命令可以看到这些线程主要是垃圾回收线程</li><li>通过jstat命令监控GC情况，可以看到Full GC次数非常多，并且次数在不断增加。</li></ul><p>首先我们可以使用<code>top</code>命令查看系统CPU的占用情况，如下是系统CPU较高的一个示例：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>top - 08:31:10 up 30 min,  0 users,  load average: 0.73, 0.58, 0.34
KiB Mem:   2046460 total,  1923864 used,   122596 free,    14388 buffers
KiB Swap:  1048572 total,        0 used,  1048572 free.  1192352 cached Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
    9 root      20   0 2557160 288976  15812 S  98.0 14.1   0:42.60 java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，有一个Java程序此时CPU占用量达到了98.8%，此时我们可以复制该进程id<code>9</code>，并且使用如下命令查看呢该进程的各个线程运行情况：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>top -Hp 9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>该进程下的各个线程运行情况如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>top - 08:31:16 up 30 min,  0 users,  load average: 0.75, 0.59, 0.35
Threads:  11 total,   1 running,  10 sleeping,   0 stopped,   0 zombie
%Cpu(s):  3.5 us,  0.6 sy,  0.0 ni, 95.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem:   2046460 total,  1924856 used,   121604 free,    14396 buffers
KiB Swap:  1048572 total,        0 used,  1048572 free.  1192532 cached Mem

  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
   10 root      20   0 2557160 289824  15872 R 79.3 14.2   0:41.49 java
   11 root      20   0 2557160 289824  15872 S 13.2 14.2   0:06.78 java
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，在进程为<code>9</code>的Java程序中各个线程的CPU占用情况，接下来我们可以通过jstack命令查看线程id为<code>10</code>的线程为什么耗费CPU最高。需要注意的是，在jsatck命令展示的结果中，线程id都转换成了十六进制形式。可以用如下命令查看转换结果，也可以找一个科学计算器进行转换：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@a39de7e7934b:/# printf &quot;%x\n&quot; 10
a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里打印结果说明该线程在jstack中的展现形式为<code>0xa</code>，通过jstack命令我们可以看到如下信息</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;main&quot; #1 prio=5 os_prio=0 tid=0x00007f8718009800 nid=0xb runnable [0x00007f871fe41000]
   java.lang.Thread.State: RUNNABLE
	at com.aibaobei.chapter2.eg2.UserDemo.main(UserDemo.java:9)

&quot;VM Thread&quot; os_prio=0 tid=0x00007f871806e000 nid=0xa runnable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的VM Thread一行的最后显示<code>nid=0xa</code>，这里nid的意思就是操作系统线程id的意思。而VM Thread指的就是垃圾回收的线程。这里我们基本上可以确定，当前系统缓慢的原因主要是垃圾回收过于频繁，导致GC停顿时间较长。我们通过如下命令可以查看GC的情况：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@8d36124607a0:/# jstat -gcutil 9 1000 10
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT
  0.00   0.00   0.00  75.07  59.09  59.60   3259    0.919  6517    7.715    8.635
  0.00   0.00   0.00   0.08  59.09  59.60   3306    0.930  6611    7.822    8.752
  0.00   0.00   0.00   0.08  59.09  59.60   3351    0.943  6701    7.924    8.867
  0.00   0.00   0.00   0.08  59.09  59.60   3397    0.955  6793    8.029    8.984
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，这里FGC指的是Full GC数量，这里高达6793，而且还在不断增长。从而进一步证实了是由于内存溢出导致的系统缓慢。那么这里确认了内存溢出，但是如何查看你是哪些对象导致的内存溢出呢，这个可以dump出内存日志，然后通过eclipse的mat工具进行查看，如下是其展示的一个对象树结构：</p><p>![image-20200317004122623](/Users/zsz/Library/Application Support/typora-user-images/image-20200317004122623.png)</p><p>经过mat工具分析之后，我们基本上就能确定内存中主要是哪个对象比较消耗内存，然后找到该对象的创建位置，进行处理即可。这里的主要是PrintStream最多，但是我们也可以看到，其内存消耗量只有12.2%。也就是说，其还不足以导致大量的Full GC，此时我们需要考虑另外一种情况，就是代码或者第三方依赖的包中有显示的<code>System.gc()</code>调用。这种情况我们查看dump内存得到的文件即可判断，因为其会打印GC原因：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[Full GC (System.gc()) [Tenured: 262546K-&gt;262546K(349568K), 0.0014879 secs] 262546K-&gt;262546K(506816K), [Metaspace: 3109K-&gt;3109K(1056768K)], 0.0015151 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] 
[GC (Allocation Failure) [DefNew: 2795K-&gt;0K(157248K), 0.0001504 secs][Tenured: 262546K-&gt;402K(349568K), 0.0012949 secs] 265342K-&gt;402K(506816K), [Metaspace: 3109K-&gt;3109K(1056768K)], 0.0014699 secs] [Times: user=0.00
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>比如这里第一次GC是由于<code>System.gc()</code>的显示调用导致的，而第二次GC则是JVM主动发起的。总结来说，对于Full GC次数过多，主要有以下两种原因：</p><ul><li>代码中一次获取了大量的对象，导致内存溢出，此时可以通过eclipse的mat工具查看内存中有哪些对象比较多；</li><li>内存占用不高，但是Full GC次数还是比较多，此时可能是显示的<code>System.gc()</code>调用导致GC次数过多，这可以通过添加<code>-XX:+DisableExplicitGC</code>来禁用JVM对显示GC的响应。</li></ul><h3 id="_3-2-cpu过高" tabindex="-1"><a class="header-anchor" href="#_3-2-cpu过高" aria-hidden="true">#</a> 3.2 CPU过高</h3><p>查看参考文章</p><h3 id="_3-3-不定期出现的接口耗时现象" tabindex="-1"><a class="header-anchor" href="#_3-3-不定期出现的接口耗时现象" aria-hidden="true">#</a> 3.3 不定期出现的接口耗时现象</h3><p>查看参考文章</p><h3 id="_3-4-某个线程进入waiting状态" tabindex="-1"><a class="header-anchor" href="#_3-4-某个线程进入waiting状态" aria-hidden="true">#</a> 3.4 某个线程进入WAITING状态</h3><p>查看参考文章</p><h3 id="_3-5-死锁" tabindex="-1"><a class="header-anchor" href="#_3-5-死锁" aria-hidden="true">#</a> 3.5 死锁</h3><p>查看参考文章</p><h2 id="_4-总结" tabindex="-1"><a class="header-anchor" href="#_4-总结" aria-hidden="true">#</a> 4. 总结</h2><ol><li>通过top命令查看cpu情况，</li><li>如果CPU比较高， <ol><li>则通过<code>top -Hp &lt;pid&gt;</code> 命令查看当前进程的各个线程运行情况，</li><li>找出CPU过高的线程之后，将其线程id转换为十六进制的表现形式</li><li>然后在jstack日志中查看该线程主要在进行的工作 <ol><li>如果是正常的用户线程，则通过该线程的堆栈信息查看其具体是在哪处用户代码处运行比较消耗CPU；</li><li>如果该线程是<code>VM Thread</code>，则通过<code>jstat -gcutil </code>命令监控当前系统的GC状况，然后通过<code>jmap dump:format=b,file= </code>导出系统当前的内存数据。导出之后将内存情况放到eclipse的mat工具中进行分析即可得出内存中主要是什么对象比较消耗内存，进而可以处理相关代码；</li></ol></li><li>如果通过<code>top</code>命令看到CPU并不高，并且系统内存占用率也比较低。此时就可以考虑是否是由于另外三种情况导致的问题 <ol><li>如果是接口调用比较耗时，并且是不定时出现，则可以通过压测的方式加大阻塞点出现的频率，从而通过<code>jstack</code>查看堆栈信息，找到阻塞点；</li><li>如果是某个功能突然出现停滞的状况，这种情况也无法复现，此时可以通过多次导出<code>jstack</code>日志的方式对比哪些用户线程是一直都处于等待状态，这些线程就是可能存在问题的线程；</li><li>如果通过<code>jstack</code>可以查看到死锁状态，则可以检查产生死锁的两个线程的具体阻塞点，从而处理相应的问题。</li></ol></li></ol></li></ol><h2 id="面试实战" tabindex="-1"><a class="header-anchor" href="#面试实战" aria-hidden="true">#</a> 面试实战</h2><p>FullGC你再线上遇到问题你应该怎么排查？</p><blockquote><ol><li>使用 jstat -gcutil 命令监控当前系统GC状况</li><li>通过jmap dump：format=b,file=导出系统当前的内存数据</li><li>通过mat工具分析得出内存中主要什么对象消耗内存，进而可以处理相关代码</li></ol></blockquote><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2><p><a href="https://zhuanlan.zhihu.com/p/84203026" target="_blank" rel="noopener noreferrer">面试被问：如果系统 CPU 突然飙升且 GC 频繁，你该如何排查？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/zszdevelop/java-study-gitbook/edit/main/docs/java/jvm/java-jvm-gc-fullgc.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zszdevelop@163.com">zszdevelop</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/java/jvm/java-jvm-classload-simplify.html" class="nav-link prev" aria-label="类加载过程(精简版)"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->类加载过程(精简版)</div></a><a href="/java/jvm/java-jvm-tools-mat-peoject.html" class="nav-link next" aria-label="记一次MAT分析线上项目过程"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">记一次MAT分析线上项目过程<!----></div></a></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href='https://beian.miit.gov.cn' target='_blank' style='color: var(--c-text-lighter);>闽ICP备18001806号-1</a></div><div class="copyright">Copyright © 2024 zszdevelop</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-891e5fab.js" defer></script>
  </body>
</html>
