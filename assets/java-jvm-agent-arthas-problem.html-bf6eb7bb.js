import{_ as r,W as s,X as i,Y as e,Z as a,$ as n,a0 as c,D as l}from"./framework-0cf5f349.js";const d={},h=e("h1",{id:"调试排错-arthas-遇到的问题",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#调试排错-arthas-遇到的问题","aria-hidden":"true"},"#"),a(" 调试排错 - Arthas 遇到的问题")],-1),o=e("h2",{id:"_1-无法trace-和watch加载skywalking7-的jar中的类方法",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-无法trace-和watch加载skywalking7-的jar中的类方法","aria-hidden":"true"},"#"),a(" 1. 无法trace 和watch加载skywalking7 的jar中的类方法")],-1),_={href:"https://so.csdn.net/so/search?q=arthas&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},p={href:"https://github.com/alibaba/arthas/issues/1141",target:"_blank",rel:"noopener noreferrer"},k=c(`<p>影响的方法</p><ul><li><p>trace</p></li><li><p>watch</p></li><li><h4 id="stack" tabindex="-1"><a class="header-anchor" href="#stack" aria-hidden="true">#</a> stack</h4></li><li><p>monitor</p></li></ul><h2 id="_2-解决" tabindex="-1"><a class="header-anchor" href="#_2-解决" aria-hidden="true">#</a> 2. 解决</h2><p>在arthas的github中搜索相似问题，根源在于skywalking的工作机制，是ByteBuddy class cache特性导致了问题，项目启动的时候skywalking采用ByteBuddy转换类，ByteBuddy每次生成不同的附属类，类名称随机，当另外一个代理转换相同的类，触发skywalking再生成另外一个附属类，且名称不同，字节码被改动，类的属性field变更，jvm校验类的字节码时失败，导致转换失败。</p><p>skywalking提供两种解决方案：</p><p>服务启动的时候开启增强类的缓存功能，添加如下启动参数</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>-Dskywalking.agent.is_cache_enhanced_class=true -Dskywalking.agent.class_cache_mode=MEMORY
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改代理类配置文件agent.conf:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>agent.is_cache_enhanced_class = \${SW_AGENT_CACHE_CLASS:false}
agent.class_cache_mode = \${SW_AGENT_CLASS_CACHE_MODE:MEMORY}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,10),u={href:"https://blog.csdn.net/weixin_42106289/article/details/128467219",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/alibaba/arthas/issues/1141",target:"_blank",rel:"noopener noreferrer"};function m(b,f){const t=l("ExternalLinkIcon");return s(),i("div",null,[h,o,e("p",null,[a("未集成skywalking之前，atrhas正常工作，集成skywalking后"),e("a",_,[a("arthas"),n(t)]),a("的watch、trace命令失败，提示Enhance error! exception: java.lang.UnsupportedOperationException")]),e("p",null,[e("a",p,[a("原文：无法trace 和watch加载skywalking7 的jar中的类方法"),n(t)])]),k,e("p",null,[e("a",u,[a("skywalking兼容arthas问题"),n(t)])]),e("p",null,[e("a",g,[a("原文：无法trace 和watch加载skywalking7 的jar中的类方法"),n(t)])])])}const w=r(d,[["render",m],["__file","java-jvm-agent-arthas-problem.html.vue"]]);export{w as default};
